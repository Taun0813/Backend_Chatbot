services:
  # Discovery Service (Eureka)
  - type: web
    name: discovery-service
    runtime: docker
    repo: https://github.com/YOUR_REPO_URL/Backend_Chatbot # Render automatically infers this
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: discovery-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
    plan: free

  # API Gateway
  - type: web
    name: api-gateway
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: api-gateway
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
    plan: free

  # Product Service
  - type: web
    name: product-service
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: product-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      # Connection to Discovery
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
      # Database Connection (IMPORTANT: You need a managed Postgres on Render or external)
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://hostname:5432/db_name
      - key: SPRING_DATASOURCE_USERNAME
        value: user
      - key: SPRING_DATASOURCE_PASSWORD
        value: pass
    plan: free

  # User Service
  - type: web
    name: user-service
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: user-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
    plan: free

  # Order Service
  - type: web
    name: order-service
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: order-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
    plan: free

  # Inventory Service
  - type: web
    name: inventory-service
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: inventory-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
    plan: free

  # Cart Service
  - type: web
    name: cart-service
    runtime: docker
    rootDir: .
    dockerContext: .
    dockerfilePath: infrastructure/docker/Dockerfile
    envVars:
      - key: MODULE_NAME
        value: cart-service
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        fromService:
          type: web
          name: discovery-service
          property: url
          envVarKey: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
          value: /eureka/
    plan: free

databases:
  - name: ai-agent-db
    plan: free
    databaseName: ai_agent
    user: ai_agent

